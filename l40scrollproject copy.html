<!DOCTYPE html>
<html lang="en">
<head>
    <title>Scroll Project Exercise</title>
    <style type="text/css">
        body{
            font-family: sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
        }

        .post{
            width: 500px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            padding: 20px;
            margin: 40px 0;
            position: relative;
        }

        .post .postid{
            width: 30px;
            height: 30px;
            background-color: black;
            color: white;
            font-size: 15px;
            border-radius: 50%;
            position: absolute;
            right: -15px;
            bottom: -15px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loader{
            display: none; /* Change display to none initially */
            position: fixed;
            bottom: 10px;
        }

        .loader.show{
            display: flex; /* Show loader when class is added */
            opacity: 1;
        }

        .triangle{
            width: 0px;
            height: 0px;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid blue;
            margin:5px;
            animation: myani 0.5s ease-in-out infinite;
        }

        .triangle:nth-of-type(2){
            animation-delay: 0.1s;
        }

        .triangle:nth-of-type(3){
            animation-delay: 0.2s;
        }

        @keyframes myani{
            0%{
                transform: translateY(0);
            }
            50%{
                transform: translateY(-10px);
            }
            100%{
                transform: translatey(0);
            }
        }
    </style>
</head>
<body>
    <div class="container"></div>

    <div class="loader">
        <div class="triangle"></div>
        <div class="triangle"></div>
        <div class="triangle"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        const getContainer = document.querySelector('.container');
        const loader = document.querySelector('.loader');

        let page = 1;
        const limit = 3;
        let x = 0;
        let isLoading = false;

        // API Binding
        async function getPosts() {
            const url = `https://randomuser.me/api/?page=${page}&results=${limit}&seed=abc`;

            return await fetch(url)
                .then(response => response.json())
                .then(data => data.results)
                .catch(err => console.log(err));
        }

        // Post UI creation with API 
        async function showPostToDOM() {
            const getUsers = await getPosts();

            getUsers.forEach((getUser, idx) => {
                const newDiv = document.createElement("div");
                newDiv.classList.add("post");

                newDiv.innerHTML = `
                    <div class="postid">${++x}</div>
                    <div class="info">
                        <img src="${getUser.picture.large}" alt="${getUser.name.first}" />
                        <h4 class="title">${getUser.name.title}.${getUser.name.first} ${getUser.name.last}</h4>
                        <a href="tel:${getUser.phone}" class="content">${getUser.phone}</a>
                        <br>
                        <a href="mailto:${getUser.email}" class="content">${getUser.email}</a>
                        <p class="country">${getUser.location.country}</p>
                    </div>
                `;

                getContainer.appendChild(newDiv);
            });
        }

        showPostToDOM();

        // Scroll Event Listener with Debounce
        window.addEventListener('scroll', () => {
            if (isLoading) return;

            const { scrollTop, clientHeight, scrollHeight } = document.documentElement;
            
            // Check if user has reached bottom
            if (scrollTop + clientHeight >= scrollHeight - 8) {
                showLoading();
            }
        });

        function showLoading() {
            loader.classList.add('show');
            isLoading = true;

            setTimeout(() => {
                loader.classList.remove('show');
                page++;
                showPostToDOM();
                isLoading = false;
            }, 1000); // Added small delay for loading effect
        }
    </script>
</body>
</html>
